@model OrdersFrontEnd.Models.OrderItem

@{
	var productsList = ViewBag.productsList;
	var ordersId = ViewBag.ordersId;
}


<form method="post" asp-controller="OrderItem" asp-action="AddOrderItem">
	<div class="border p-3 mt-4" style="max-width: 500px; margin: 0 auto;">
		<div class="row pb-2">
			<h2 class="text-primary text-center">Add New OrderItem</h2>
			<hr />
		</div>
		<div class="mb-2 row p-1" style="margin-bottom: 10px;">
			<label asp-for="OrderId" class="p-0"></label>
			<input asp-for="OrderId" class="form-control" value="@ordersId" readonly />
			<span asp-validation-for="OrderId" class="text-danger" ></span>
		</div>
		<div class="mb-2 row p-1" style="margin-bottom: 10px;">
			<label asp-for="ProductId" class="p-0"></label>
			<input asp-for="ProductId" class="form-control" id="ProdId" readonly />
			<span asp-validation-for="ProductId" class="text-danger"></span>
		</div>
		<div class="mb-2 row p-1" style="margin-bottom: 10px;">
			<label asp-for="Quantity" class="p-0"></label>
			<input asp-for="Quantity" class="form-control" min="0"/>
			<span asp-validation-for="Quantity" class="text-danger"></span>
		</div>
		<div class="mb-2 row p-1" style="margin-bottom: 10px;">
			<label asp-for="UnitPrice" class="p-0"></label>
			<input asp-for="UnitPrice" class="form-control" readonly />
			<span asp-validation-for="UnitPrice" class="text-danger"></span>
		</div>

		<div class="row">
			<div class="col-6 col-md-3">
				<button type="submit" class="btn btn-primary form-control">Create</button>
			</div>
			<div class="col-6 col-md-3">
				<a asp-controller="OrderItem" asp-action="Index" class="btn btn-outline-secondary form-control">
					Back
				</a>
			</div>
		</div>
	</div>
</form>

<br />
<br />

<h2>Products</h2>


<table class="table table-bordered table-striped">
	<thead>
		<tr>
			<th>
				Id
			</th>
			<th>
				Name
			</th>
			<th>
				Price
			</th>
			<th>
				Quantity
			</th>


		</tr>
	</thead>
	<tbody>
		@foreach (var item in productsList)
		{
			<tr>
				<td>@item.ProductId</td>
				<td>@item.Name</td>
				<td>@item.Price</td>
				<td>@item.StockQuantity</td>
				<td>
					<button type="button" class="btn btn-info select-product" data-product-id="@item.ProductId">Select</button>
				</td>
			</tr>

		}
	</tbody>
</table>


<script>
	var price;
	document.addEventListener("DOMContentLoaded", function () {
		document.querySelectorAll('.select-product').forEach(button => {
			button.addEventListener('click', function () {
				var productId = this.getAttribute('data-product-id');

				document.getElementById('ProdId').value = productId;

				var parentRow = this.closest('tr');

				var quantity = parentRow.cells[3].textContent.trim();
				price = parentRow.cells[2].textContent.trim(); 
				price = parseFloat(price.replace(/[^\d.]/g, '')); 
				
				if (isNaN(price)) {
					price = 0;
				}

				document.getElementById('Quantity').setAttribute('max', quantity);
			});
		});
	});

	document.addEventListener("DOMContentLoaded", function () {
		var quantityInput = document.getElementById('Quantity');

		quantityInput.addEventListener('input', function () {
			var quantity = parseFloat(this.value);

			var totalPrice = quantity * price;

			document.getElementById('UnitPrice').value = totalPrice.toFixed(2);
		});
	});
</script>
